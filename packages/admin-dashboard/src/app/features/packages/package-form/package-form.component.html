<div class="package-form">
  <a routerLink="/packages" class="package-form__back">&larr; Back to Packages</a>
  <h2 class="package-form__title">New Package</h2>

  @if (errorMessage) {
    <div class="package-form__error">{{ errorMessage }}</div>
  }

  <form [formGroup]="packageForm" (ngSubmit)="onSubmit()" class="package-form__form">
    <h3 class="package-form__section-title">Origin</h3>
    <div class="package-form__row">
      <div class="package-form__field">
        <label>City</label>
        <app-city-autocomplete
          formControlName="originCity"
          (citySelected)="onOriginCitySelected($event)"
        ></app-city-autocomplete>
      </div>
      <div class="package-form__field">
        <label>Address</label>
        <input formControlName="originAddress" placeholder="Enter origin address" (blur)="onOriginAddressBlur()" />
        @if (originGeocoding) {
          <span class="package-form__geocoding">Resolving coordinates...</span>
        }
      </div>
    </div>
    @if (originLat !== null && originLng !== null) {
      <div class="package-form__resolved">
        Coordinates: {{ originLat | number:'1.3-3' }}, {{ originLng | number:'1.3-3' }}
        @if (originNearest) {
          &middot; Nearest: {{ originNearest.name }} ({{ originNearest.distanceKm | number:'1.1-1' }} km)
        }
      </div>
    }

    <h3 class="package-form__section-title">Destination</h3>
    <div class="package-form__row">
      <div class="package-form__field">
        <label>City</label>
        <app-city-autocomplete
          formControlName="destinationCity"
          (citySelected)="onDestinationCitySelected($event)"
        ></app-city-autocomplete>
      </div>
      <div class="package-form__field">
        <label>Address</label>
        <input formControlName="destinationAddress" placeholder="Enter destination address" (blur)="onDestinationAddressBlur()" />
        @if (destinationGeocoding) {
          <span class="package-form__geocoding">Resolving coordinates...</span>
        }
      </div>
    </div>
    @if (destLat !== null && destLng !== null) {
      <div class="package-form__resolved">
        Coordinates: {{ destLat | number:'1.3-3' }}, {{ destLng | number:'1.3-3' }}
        @if (destinationNearest) {
          &middot; Nearest: {{ destinationNearest.name }} ({{ destinationNearest.distanceKm | number:'1.1-1' }} km)
        }
      </div>
    }

    <h3 class="package-form__section-title">Dimensions</h3>
    <div class="package-form__row">
      <div class="package-form__field">
        <label>Weight (kg)</label>
        <input type="number" formControlName="weightKg" step="0.01" />
      </div>
      <div class="package-form__field">
        <label>Length (cm)</label>
        <input type="number" formControlName="lengthCm" step="0.01" />
      </div>
      <div class="package-form__field">
        <label>Width (cm)</label>
        <input type="number" formControlName="widthCm" step="0.01" />
      </div>
      <div class="package-form__field">
        <label>Height (cm)</label>
        <input type="number" formControlName="heightCm" step="0.01" />
      </div>
    </div>

    <div class="package-form__field">
      <label>Contents Description</label>
      <textarea formControlName="contentsDescription" rows="3" placeholder="Describe contents..."></textarea>
    </div>

    <button type="submit" [disabled]="packageForm.invalid || isSubmitting" class="package-form__submit">
      {{ isSubmitting ? 'Creating...' : 'Create Package' }}
    </button>
  </form>
</div>
